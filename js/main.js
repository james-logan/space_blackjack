"use strict";

var $newGame = $('.new-game');
var ID;

$newGame.click(function () {
  playerHand = [];
  dealerHand = [];
  $(".box").html("");
  getJSON('http://deckofcardsapi.com/api/shuffle/?deck_count=1', function (d) {
    // console.log(d.deck_id)
    ID = d.deck_id;
    $("button").attr("disabled", false);
    $(".win-bust").html("").removeClass("bust").removeClass("win");
    startGame(ID);
  });
});

var dealerHand = [];
var playerHand = [];

function displayCard(character, image) {
  $(character).append("<img src=" + image + ">");
};

function totaler(hand) {
  var total = 0;
  hand.forEach(function (card, index) {
    var actualValue;
    if (parseInt(card.value)) {
      actualValue = parseInt(card.value);
    } else if (index === hand.length - 1 && card.value === "ACE" && total > 10) {
      actualValue = 1;
    } else if (index === hand.length - 1 && card.value === "ACE") {
      actualValue = 11;
    } else if (card.value === "ACE") {
      console.log("1:", hand);
      hand.push(hand.splice(index, 1)[0]);
      console.log("2:", hand);
    } else {
      actualValue = 10;
    }
    total += actualValue;
  });
  if (total > 21) {
    endState(hand, "bust", "BUST!");
    return 'bust';
  } else {
    return total;
  }
}

function endState(han, clas, strin) {
  $(".button-box > button").attr("disabled", true);
  if (han === playerHand) {
    $(".win-bust").addClass(clas).html(strin);
  } else {
    $(".win-bust").addClass("win").html("YOU WIN!");
  };
}

function startGame(id) {
  var drawUrl = "http://deckofcardsapi.com/api/draw/" + id + "/?count=3";
  getJSON(drawUrl, function (data) {
    for (var i = 0; i < 3; i++) {
      if (i % 2 === 0) {
        playerHand.push(data.cards[i]);
        displayCard(".player-box", data.cards[i].image);
        totaler(playerHand);
      } else {
        dealerHand.push(data.cards[i]);
        displayCard(".dealer-box", data.cards[i].image);
      };
    }
  });
}

//HIT BUTTON

$(".hit").click(function () {
  $(this).css("margin-top", "20px");
  hit(playerHand, ".player-box");
});

function hit(hand, div) {
  getJSON("http://deckofcardsapi.com/api/draw/" + ID + "/?count=1", function (data) {
    hand.push(data.cards[0]);
    displayCard(div, data.cards[0].image);
    totaler(hand);
  });
}

//STAND BUTTON
$(".stand").click(function () {
  $(".button-box > button").attr("disabled", true);
  getIt(dealerHand, ".dealer-box");
});

function getIt(hand, div) {
  getJSON("http://deckofcardsapi.com/api/draw/" + ID + "/?count=1", function (data) {
    hand.push(data.cards[0]);
    displayCard(div, data.cards[0].image);
    dealer(totaler(hand));
  });
}

function dealer(value) {
  if (value === 'bust') {
    $(".win-bust").addClass("win").html("YOU WIN!");
  } else if (value < 17) {
    getIt(dealerHand, ".dealer-box");
  } else {
    if (totaler(dealerHand) >= totaler(playerHand)) {
      $(".win-bust").addClass("bust").html("LOSE!");
    } else {
      $(".win-bust").addClass("win").html("YOU WIN!");
    }
  }
}

//Get JSON OBJECT

function getJSON(url, cb) {
  var JSONP_PROXY = 'https://jsonp.afeld.me/?url=';
  // THIS WILL ADD THE CROSS ORIGIN HEADERS

  var request = new XMLHttpRequest();

  request.open('GET', JSONP_PROXY + url);

  request.onload = function () {
    if (request.status >= 200 && request.status < 400) {
      cb(JSON.parse(request.responseText));
    }
  };

  request.send();
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9qcy9tYWluLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsSUFBSSxRQUFRLEdBQUcsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxDQUFBO0FBQzdCLElBQUksRUFBRSxDQUFDOztBQUVQLFFBQVEsQ0FBQyxLQUFLLENBQUMsWUFBWTtBQUN6QixZQUFVLEdBQUcsRUFBRSxDQUFDO0FBQ2hCLFlBQVUsR0FBRyxFQUFFLENBQUM7QUFDaEIsR0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQTtBQUNsQixTQUFPLENBQUMscURBQXFELEVBQUUsVUFBVSxDQUFDLEVBQUU7O0FBRTVFLE1BQUUsR0FBRyxDQUFDLENBQUMsT0FBTyxDQUFDO0FBQ2YsS0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFDLElBQUksQ0FBQyxVQUFVLEVBQUUsS0FBSyxDQUFDLENBQUE7QUFDbkMsS0FBQyxDQUFDLFdBQVcsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxXQUFXLENBQUMsTUFBTSxDQUFDLENBQUMsV0FBVyxDQUFDLEtBQUssQ0FBQyxDQUFBO0FBQzlELGFBQVMsQ0FBQyxFQUFFLENBQUMsQ0FBQTtHQUNaLENBQUMsQ0FBQztDQUNKLENBQUMsQ0FBQzs7QUFFSCxJQUFJLFVBQVUsR0FBRyxFQUFFLENBQUM7QUFDcEIsSUFBSSxVQUFVLEdBQUcsRUFBRSxDQUFDOztBQUdwQixTQUFTLFdBQVcsQ0FBRSxTQUFTLEVBQUUsS0FBSyxFQUFFO0FBQ3RDLEdBQUMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxNQUFNLENBQUMsV0FBVyxHQUFHLEtBQUssR0FBRyxHQUFHLENBQUMsQ0FBQTtDQUMvQyxDQUFDOztBQUVGLFNBQVMsT0FBTyxDQUFFLElBQUksRUFBRTtBQUN0QixNQUFJLEtBQUssR0FBRyxDQUFDLENBQUM7QUFDZCxNQUFJLENBQUMsT0FBTyxDQUFDLFVBQVUsSUFBSSxFQUFFLEtBQUssRUFBRTtBQUNsQyxRQUFJLFdBQVcsQ0FBQztBQUNoQixRQUFJLFFBQVEsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLEVBQUU7QUFBQyxpQkFBVyxHQUFHLFFBQVEsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUE7S0FBQyxNQUN6RCxJQUFJLEtBQUssS0FBTSxJQUFJLENBQUMsTUFBTSxHQUFHLENBQUMsQUFBQyxJQUFJLElBQUksQ0FBQyxLQUFLLEtBQUssS0FBSyxJQUFJLEtBQUssR0FBRyxFQUFFLEVBQUU7QUFDMUUsaUJBQVcsR0FBRyxDQUFDLENBQUM7S0FDakIsTUFBTSxJQUFJLEtBQUssS0FBSyxJQUFJLENBQUMsTUFBTSxHQUFFLENBQUMsQUFBQyxJQUFJLElBQUksQ0FBQyxLQUFLLEtBQUssS0FBSyxFQUFFO0FBQzFELGlCQUFXLEdBQUcsRUFBRSxDQUFDO0tBQ3BCLE1BQU0sSUFBSSxJQUFJLENBQUMsS0FBSyxLQUFLLEtBQUssRUFBRTtBQUM3QixhQUFPLENBQUMsR0FBRyxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQTtBQUN2QixVQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUE7QUFDbkMsYUFBTyxDQUFDLEdBQUcsQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUM7S0FDM0IsTUFBTTtBQUNMLGlCQUFXLEdBQUcsRUFBRSxDQUFDO0tBQ2xCO0FBQ0QsU0FBSyxJQUFJLFdBQVcsQ0FBQTtHQUNyQixDQUFDLENBQUM7QUFDSCxNQUFJLEtBQUssR0FBQyxFQUFFLEVBQUU7QUFDWixZQUFRLENBQUMsSUFBSSxFQUFFLE1BQU0sRUFBRSxPQUFPLENBQUMsQ0FBQztBQUNoQyxXQUFPLE1BQU0sQ0FBQTtHQUNkLE1BQU07QUFBQyxXQUFPLEtBQUssQ0FBQTtHQUFDO0NBQ3RCOztBQUVELFNBQVMsUUFBUSxDQUFFLEdBQUcsRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFO0FBQ2pDLEdBQUMsQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDLElBQUksQ0FBQyxVQUFVLEVBQUUsSUFBSSxDQUFDLENBQUM7QUFDakQsTUFBSSxHQUFHLEtBQUssVUFBVSxFQUFFO0FBQ3RCLEtBQUMsQ0FBQyxXQUFXLENBQUMsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFBO0dBQUMsTUFDdkM7QUFDSCxLQUFDLENBQUMsV0FBVyxDQUFDLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQTtHQUNoRCxDQUFDO0NBQ0w7O0FBRUQsU0FBUyxTQUFTLENBQUUsRUFBRSxFQUFFO0FBQ3RCLE1BQUksT0FBTyxHQUFHLHFDQUFxQyxHQUFHLEVBQUUsR0FBRyxXQUFXLENBQUE7QUFDdEUsU0FBTyxDQUFDLE9BQU8sRUFBRSxVQUFVLElBQUksRUFBRTtBQUMvQixTQUFLLElBQUksQ0FBQyxHQUFDLENBQUMsRUFBRSxDQUFDLEdBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFO0FBQ3RCLFVBQUksQ0FBQyxHQUFDLENBQUMsS0FBSyxDQUFDLEVBQUU7QUFDYixrQkFBVSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUE7QUFDOUIsbUJBQVcsQ0FBQyxhQUFhLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQTtBQUMvQyxlQUFPLENBQUMsVUFBVSxDQUFDLENBQUM7T0FDckIsTUFDSTtBQUNILGtCQUFVLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQTtBQUM5QixtQkFBVyxDQUFDLGFBQWEsRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFBO09BQ2hELENBQUM7S0FDSDtHQUNGLENBQUMsQ0FBQTtDQUNIOzs7O0FBTUQsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLEtBQUssQ0FBQyxZQUFZO0FBQzFCLEdBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxHQUFHLENBQUMsWUFBWSxFQUFFLE1BQU0sQ0FBQyxDQUFBO0FBQ2pDLEtBQUcsQ0FBQyxVQUFVLEVBQUUsYUFBYSxDQUFDLENBQUM7Q0FDaEMsQ0FBQyxDQUFDOztBQUVILFNBQVMsR0FBRyxDQUFFLElBQUksRUFBRSxHQUFHLEVBQUU7QUFDdkIsU0FBTyxDQUFDLHFDQUFxQyxHQUFHLEVBQUUsR0FBRyxXQUFXLEVBQUUsVUFBVSxJQUFJLEVBQUU7QUFDaEYsUUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUE7QUFDeEIsZUFBVyxDQUFDLEdBQUcsRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDO0FBQ3RDLFdBQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQTtHQUNkLENBQUMsQ0FBQztDQUNKOzs7QUFHRCxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUMsS0FBSyxDQUFDLFlBQVk7QUFDNUIsR0FBQyxDQUFDLHNCQUFzQixDQUFDLENBQUMsSUFBSSxDQUFDLFVBQVUsRUFBRSxJQUFJLENBQUMsQ0FBQztBQUNqRCxPQUFLLENBQUMsVUFBVSxFQUFFLGFBQWEsQ0FBQyxDQUFBO0NBQ2pDLENBQUMsQ0FBQTs7QUFFRixTQUFTLEtBQUssQ0FBRSxJQUFJLEVBQUUsR0FBRyxFQUFFO0FBQ3pCLFNBQU8sQ0FBQyxxQ0FBcUMsR0FBRyxFQUFFLEdBQUcsV0FBVyxFQUFFLFVBQVUsSUFBSSxFQUFFO0FBQ2hGLFFBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFBO0FBQ3hCLGVBQVcsQ0FBQyxHQUFHLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQztBQUN0QyxVQUFNLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUE7R0FDdEIsQ0FBQyxDQUFDO0NBQ0o7O0FBR0QsU0FBUyxNQUFNLENBQUUsS0FBSyxFQUFFO0FBQ3RCLE1BQUssS0FBSyxLQUFLLE1BQU0sRUFBRTtBQUNyQixLQUFDLENBQUMsV0FBVyxDQUFDLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQTtHQUNoRCxNQUFNLElBQUksS0FBSyxHQUFHLEVBQUUsRUFBRTtBQUNyQixTQUFLLENBQUMsVUFBVSxFQUFFLGFBQWEsQ0FBQyxDQUFDO0dBQ2xDLE1BQU07QUFDTCxRQUFJLE9BQU8sQ0FBQyxVQUFVLENBQUMsSUFBSSxPQUFPLENBQUMsVUFBVSxDQUFDLEVBQUU7QUFDOUMsT0FBQyxDQUFDLFdBQVcsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUE7S0FDOUMsTUFBTTtBQUNMLE9BQUMsQ0FBQyxXQUFXLENBQUMsQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFBO0tBQ2hEO0dBQ0Y7Q0FDRjs7OztBQUtELFNBQVMsT0FBTyxDQUFDLEdBQUcsRUFBRSxFQUFFLEVBQUU7QUFDeEIsTUFBSSxXQUFXLEdBQUcsOEJBQThCLENBQUE7OztBQUdoRCxNQUFJLE9BQU8sR0FBRyxJQUFJLGNBQWMsRUFBRSxDQUFDOztBQUVuQyxTQUFPLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBRSxXQUFXLEdBQUcsR0FBRyxDQUFDLENBQUM7O0FBRXZDLFNBQU8sQ0FBQyxNQUFNLEdBQUcsWUFBVztBQUMzQixRQUFJLE9BQU8sQ0FBQyxNQUFNLElBQUksR0FBRyxJQUFJLE9BQU8sQ0FBQyxNQUFNLEdBQUcsR0FBRyxFQUFFO0FBQ2pELFFBQUUsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDO0tBQ3RDO0dBQ0QsQ0FBQzs7QUFFRixTQUFPLENBQUMsSUFBSSxFQUFFLENBQUM7Q0FDaEIiLCJmaWxlIjoic3JjL2pzL21haW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgJG5ld0dhbWUgPSAkKCcubmV3LWdhbWUnKVxudmFyIElEO1xuXG4kbmV3R2FtZS5jbGljayhmdW5jdGlvbiAoKSB7XG4gIHBsYXllckhhbmQgPSBbXTtcbiAgZGVhbGVySGFuZCA9IFtdO1xuICAkKFwiLmJveFwiKS5odG1sKFwiXCIpXG4gIGdldEpTT04oJ2h0dHA6Ly9kZWNrb2ZjYXJkc2FwaS5jb20vYXBpL3NodWZmbGUvP2RlY2tfY291bnQ9MScsIGZ1bmN0aW9uIChkKSB7XG4gIC8vIGNvbnNvbGUubG9nKGQuZGVja19pZClcbiAgSUQgPSBkLmRlY2tfaWQ7XG4gICQoXCJidXR0b25cIikuYXR0cihcImRpc2FibGVkXCIsIGZhbHNlKVxuICAkKFwiLndpbi1idXN0XCIpLmh0bWwoXCJcIikucmVtb3ZlQ2xhc3MoXCJidXN0XCIpLnJlbW92ZUNsYXNzKFwid2luXCIpXG4gIHN0YXJ0R2FtZShJRClcbiAgfSk7XG59KTtcblxudmFyIGRlYWxlckhhbmQgPSBbXTtcbnZhciBwbGF5ZXJIYW5kID0gW107XG5cblxuZnVuY3Rpb24gZGlzcGxheUNhcmQgKGNoYXJhY3RlciwgaW1hZ2UpIHtcbiAgJChjaGFyYWN0ZXIpLmFwcGVuZChcIjxpbWcgc3JjPVwiICsgaW1hZ2UgKyBcIj5cIilcbn07XG5cbmZ1bmN0aW9uIHRvdGFsZXIgKGhhbmQpIHtcbiAgdmFyIHRvdGFsID0gMDtcbiAgaGFuZC5mb3JFYWNoKGZ1bmN0aW9uIChjYXJkLCBpbmRleCkge1xuICAgIHZhciBhY3R1YWxWYWx1ZTtcbiAgICBpZiAocGFyc2VJbnQoY2FyZC52YWx1ZSkpIHthY3R1YWxWYWx1ZSA9IHBhcnNlSW50KGNhcmQudmFsdWUpfVxuICAgIGVsc2UgaWYgKGluZGV4ID09PSAoaGFuZC5sZW5ndGggLSAxKSAmJiBjYXJkLnZhbHVlID09PSBcIkFDRVwiICYmIHRvdGFsID4gMTApIHtcbiAgICAgIGFjdHVhbFZhbHVlID0gMTtcbiAgICB9IGVsc2UgaWYgKGluZGV4ID09PShoYW5kLmxlbmd0aCAtMSkgJiYgY2FyZC52YWx1ZSA9PT0gXCJBQ0VcIikge1xuICAgICAgICBhY3R1YWxWYWx1ZSA9IDExO1xuICAgIH0gZWxzZSBpZiAoY2FyZC52YWx1ZSA9PT0gXCJBQ0VcIikge1xuICAgICAgICBjb25zb2xlLmxvZyhcIjE6XCIsIGhhbmQpXG4gICAgICAgIGhhbmQucHVzaChoYW5kLnNwbGljZShpbmRleCwgMSlbMF0pXG4gICAgICAgIGNvbnNvbGUubG9nKFwiMjpcIiwgaGFuZCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGFjdHVhbFZhbHVlID0gMTA7XG4gICAgfVxuICAgIHRvdGFsICs9IGFjdHVhbFZhbHVlXG4gIH0pO1xuICBpZiAodG90YWw+MjEpIHtcbiAgICBlbmRTdGF0ZShoYW5kLCBcImJ1c3RcIiwgXCJCVVNUIVwiKTtcbiAgICByZXR1cm4gJ2J1c3QnXG4gIH0gZWxzZSB7cmV0dXJuIHRvdGFsfVxufVxuXG5mdW5jdGlvbiBlbmRTdGF0ZSAoaGFuLCBjbGFzLCBzdHJpbikge1xuICAgICQoXCIuYnV0dG9uLWJveCA+IGJ1dHRvblwiKS5hdHRyKFwiZGlzYWJsZWRcIiwgdHJ1ZSk7XG4gICAgaWYgKGhhbiA9PT0gcGxheWVySGFuZCkge1xuICAgICAgJChcIi53aW4tYnVzdFwiKS5hZGRDbGFzcyhjbGFzKS5odG1sKHN0cmluKX1cbiAgICBlbHNlIHtcbiAgICAgICQoXCIud2luLWJ1c3RcIikuYWRkQ2xhc3MoXCJ3aW5cIikuaHRtbChcIllPVSBXSU4hXCIpXG4gICAgfTtcbn1cblxuZnVuY3Rpb24gc3RhcnRHYW1lIChpZCkge1xuICB2YXIgZHJhd1VybCA9IFwiaHR0cDovL2RlY2tvZmNhcmRzYXBpLmNvbS9hcGkvZHJhdy9cIiArIGlkICsgXCIvP2NvdW50PTNcIlxuICBnZXRKU09OKGRyYXdVcmwsIGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgZm9yICh2YXIgaT0wOyBpPDM7IGkrKykge1xuICAgICAgaWYgKGklMiA9PT0gMCkge1xuICAgICAgICBwbGF5ZXJIYW5kLnB1c2goZGF0YS5jYXJkc1tpXSlcbiAgICAgICAgZGlzcGxheUNhcmQoXCIucGxheWVyLWJveFwiLCBkYXRhLmNhcmRzW2ldLmltYWdlKVxuICAgICAgICB0b3RhbGVyKHBsYXllckhhbmQpO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIGRlYWxlckhhbmQucHVzaChkYXRhLmNhcmRzW2ldKVxuICAgICAgICBkaXNwbGF5Q2FyZChcIi5kZWFsZXItYm94XCIsIGRhdGEuY2FyZHNbaV0uaW1hZ2UpXG4gICAgICB9O1xuICAgIH1cbiAgfSlcbn1cblxuXG5cbi8vSElUIEJVVFRPTlxuXG4kKFwiLmhpdFwiKS5jbGljayhmdW5jdGlvbiAoKSB7XG4gICQodGhpcykuY3NzKFwibWFyZ2luLXRvcFwiLCBcIjIwcHhcIilcbiAgaGl0KHBsYXllckhhbmQsIFwiLnBsYXllci1ib3hcIik7XG59KTtcblxuZnVuY3Rpb24gaGl0IChoYW5kLCBkaXYpIHtcbiAgZ2V0SlNPTihcImh0dHA6Ly9kZWNrb2ZjYXJkc2FwaS5jb20vYXBpL2RyYXcvXCIgKyBJRCArIFwiLz9jb3VudD0xXCIsIGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgaGFuZC5wdXNoKGRhdGEuY2FyZHNbMF0pXG4gICAgZGlzcGxheUNhcmQoZGl2LCBkYXRhLmNhcmRzWzBdLmltYWdlKTtcbiAgICB0b3RhbGVyKGhhbmQpXG4gIH0pO1xufVxuXG4vL1NUQU5EIEJVVFRPTlxuJChcIi5zdGFuZFwiKS5jbGljayhmdW5jdGlvbiAoKSB7XG4gICQoXCIuYnV0dG9uLWJveCA+IGJ1dHRvblwiKS5hdHRyKFwiZGlzYWJsZWRcIiwgdHJ1ZSk7XG4gIGdldEl0KGRlYWxlckhhbmQsIFwiLmRlYWxlci1ib3hcIilcbn0pXG5cbmZ1bmN0aW9uIGdldEl0IChoYW5kLCBkaXYpIHtcbiAgZ2V0SlNPTihcImh0dHA6Ly9kZWNrb2ZjYXJkc2FwaS5jb20vYXBpL2RyYXcvXCIgKyBJRCArIFwiLz9jb3VudD0xXCIsIGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgaGFuZC5wdXNoKGRhdGEuY2FyZHNbMF0pXG4gICAgZGlzcGxheUNhcmQoZGl2LCBkYXRhLmNhcmRzWzBdLmltYWdlKTtcbiAgICBkZWFsZXIodG90YWxlcihoYW5kKSlcbiAgfSk7XG59XG5cblxuZnVuY3Rpb24gZGVhbGVyICh2YWx1ZSkge1xuICBpZiAoIHZhbHVlID09PSAnYnVzdCcpIHtcbiAgICAkKFwiLndpbi1idXN0XCIpLmFkZENsYXNzKFwid2luXCIpLmh0bWwoXCJZT1UgV0lOIVwiKVxuICB9IGVsc2UgaWYgKHZhbHVlIDwgMTcpIHtcbiAgICBnZXRJdChkZWFsZXJIYW5kLCBcIi5kZWFsZXItYm94XCIpO1xuICB9IGVsc2Uge1xuICAgIGlmICh0b3RhbGVyKGRlYWxlckhhbmQpID49IHRvdGFsZXIocGxheWVySGFuZCkpIHtcbiAgICAgICQoXCIud2luLWJ1c3RcIikuYWRkQ2xhc3MoXCJidXN0XCIpLmh0bWwoXCJMT1NFIVwiKVxuICAgIH0gZWxzZSB7XG4gICAgICAkKFwiLndpbi1idXN0XCIpLmFkZENsYXNzKFwid2luXCIpLmh0bWwoXCJZT1UgV0lOIVwiKVxuICAgIH1cbiAgfVxufVxuXG5cbi8vR2V0IEpTT04gT0JKRUNUXG5cbmZ1bmN0aW9uIGdldEpTT04odXJsLCBjYikge1xuICB2YXIgSlNPTlBfUFJPWFkgPSAnaHR0cHM6Ly9qc29ucC5hZmVsZC5tZS8/dXJsPSdcbiAgLy8gVEhJUyBXSUxMIEFERCBUSEUgQ1JPU1MgT1JJR0lOIEhFQURFUlNcblxuICB2YXIgcmVxdWVzdCA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xuXG4gIHJlcXVlc3Qub3BlbignR0VUJywgSlNPTlBfUFJPWFkgKyB1cmwpO1xuXG4gIHJlcXVlc3Qub25sb2FkID0gZnVuY3Rpb24oKSB7XG4gICBpZiAocmVxdWVzdC5zdGF0dXMgPj0gMjAwICYmIHJlcXVlc3Quc3RhdHVzIDwgNDAwKSB7XG4gICAgIGNiKEpTT04ucGFyc2UocmVxdWVzdC5yZXNwb25zZVRleHQpKTtcbiAgIH1cbiAgfTtcblxuICByZXF1ZXN0LnNlbmQoKTtcbn1cbiJdfQ==
